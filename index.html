<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PsicoQuiz | Portal de Testes Psicológicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
            background-image: url('mente.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .quiz-container {
            max-width: 800px;
        }
        .likert-option {
            cursor: pointer;
            transition: all 0.2s;
        }
        .likert-option:hover {
            background-color: #eff6ff; /* blue-50 */
        }
        .selected-option {
            background-color: #1d4ed8 !important; /* Blue-700 escuro */
            color: white;
            font-weight: 700;
            box-shadow: 0 0 0 4px #EC4899; /* Cor pink/magenta do tema */
            transform: scale(1.05);
            border-color: transparent !important;
        }
        .quiz-card-select {
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
            border: 4px solid #f8f8f8; 
            min-height: 250px;
            border-radius: 1rem;
        }
        .quiz-card-select::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.45);
            z-index: 1;
            border-radius: inherit;
        }
        .quiz-card-select:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.2);
        }
        .quiz-content {
            position: relative;
            z-index: 2;
        }
        #card-burnout { background-image: url('bernalt.png'); }
        #card-qi { background-image: url('qi.png'); background-color: #3b82f6; } 
        #card-stress { background-image: url('estresse.png'); }
        #card-anxiety { background-image: url('ansiedade.png'); }
        #card-sadness { background-image: url('triste.png'); }
        #card-humility { background-image: url('humilde.png'); }
        #card-arrogance { background-image: url('arrogante.png'); }

        .bg-cover-center {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.7);
        }
        .text-shadow {
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        .old-price {
            text-decoration: line-through;
            opacity: 0.7;
        }
        #payment-button-container {
            min-height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
        }
        #loading-screen {
            background-color: rgba(255, 255, 255, 0.95);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #EC4899;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="text-3xl font-extrabold text-pink-600">Psico</span>
                <span class="text-3xl font-extrabold text-gray-800">Quiz</span>
            </div>
        </nav>
    </header>

    <main>
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-20 text-center" id="quiz-selection">
            <h1 class="text-5xl sm:text-6xl lg:text-7xl font-extrabold leading-tight text-white mb-4 text-shadow" style="color: #EC4899;">
                DESVENDE SUA MENTE
            </h1>
            <p class="text-xl text-white mb-12 text-shadow font-semibold">
                Escolha o teste psicológico que mais se encaixa com o momento atual da sua vida.
            </p>
            <div id="quiz-cards-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
        </section>

        <section id="quiz-section" class="quiz-container mx-auto px-4 sm:px-6 lg:px-8 py-16 hidden">
            <div class="bg-slate-50 p-6 sm:p-10 rounded-xl shadow-2xl">
                <h2 id="active-quiz-title" class="text-3xl font-bold text-center mb-8 text-gray-900"></h2>
                
                <div id="quiz-questions" class="space-y-6">
                </div>
                
                <div class="text-center mt-10">
                    <button id="submit-quiz-btn" class="px-8 py-3 bg-pink-600 text-white text-lg font-bold rounded-lg shadow-lg hover:bg-pink-700 transition duration-300 hidden">
                        VER MEU RESULTADO FINAL
                    </button>
                </div>

                <div id="quiz-result" class="mt-10 p-6 bg-slate-100 rounded-lg hidden">
                </div>
            </div>
        </section>

        <section class="bg-gray-100 py-16 mt-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl sm:text-4xl font-bold text-center mb-8 text-gray-900">
                    Sobre a PsicoQuiz
                </h2>
                <p class="text-center text-lg text-gray-600 max-w-4xl mx-auto">
                    A PsicoQuiz nasceu da necessidade de democratizar o acesso ao autoconhecimento. Acreditamos que todos merecem ferramentas valiosas para entender sua própria mente. Nossos testes são desenvolvidos com base em conceitos da psicologia, mas servem como um ponto de partida para sua jornada pessoal. Lembre-se: Autoconhecimento é poder!
                </p>
            </div>
        </section>
    </main>

    <footer class="bg-gray-900 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm">&copy; 2025 PsicoQuiz. Todos os direitos reservados.</p>
            <p class="text-xs mt-2 text-gray-500">
                Atenção: Nossos testes são ferramentas de autoavaliação e não substituem um diagnóstico clínico profissional.
            </p>
        </div>
    </footer>
    
    <div id="purchase-modal" class="modal fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-900 mb-4">Seu Relatório está Pronto!</h3>
            <p class="text-gray-700 mb-4">Seu diagnóstico foi concluído. Desbloqueie o **Relatório Completo** para revelar sua análise detalhada e plano de ação personalizado.</p>
            
            <p class="text-gray-500 text-lg old-price">De R$ 25,00</p>
            <p id="modal-price" class="text-4xl font-extrabold text-red-600 mb-4">Por R$ 8,99</p> 

            <div id="payment-button-container" class="mb-4">
                <a id="checkout-link" href="#" target="_blank" class="px-8 py-3 bg-green-600 text-white text-lg font-bold rounded-lg shadow-lg hover:bg-green-700 transition duration-300">
                    DESBLOQUEAR RELATÓRIO AGORA
                </a>
            </div>

            <p id="modal-payment-info" class="text-xs text-gray-500 mb-4">A transação é processada pelo Ko-fi (Pagamento Seguro).</p>
            <button onclick="closeModal()" class="text-sm text-gray-500 hover:text-gray-700 mt-2">
                Fechar
            </button>
        </div>
    </div>

    <div id="loading-screen" class="hidden">
        <div class="loader mb-4"></div>
        <p class="text-xl font-semibold text-gray-700">Validando seu acesso...</p>
        <p class="text-sm text-gray-500 mt-2">Aguarde um momento. Isso deve ser rápido.</p>
    </div>

<script>
    // --- DADOS DO QUIZ ---
    const QUIZ_DATA = {
        burnout: {
            title: "Teste de Burnout (Esgotamento)",
            description: "Avalie seu nível de esgotamento físico e mental relacionado ao trabalho.",
            image_id: "card-burnout",
            questions: [
                { text: "Sinto-me esgotado(a) emocionalmente ao final do dia de trabalho.", scores: [1, 2, 3, 4, 5] },
                { text: "Tenho me sentido menos realizado(a) ultimamente no meu trabalho.", scores: [1, 2, 3, 4, 5] },
                { text: "Tenho dificuldade para me concentrar em tarefas simples.", scores: [1, 2, 3, 4, 5] },
                { text: "Sinto que perdi o interesse nas minhas atividades.", scores: [1, 2, 3, 4, 5] },
                { text: "Tenho tido problemas para dormir ou acordado cansado(a).", scores: [1, 2, 3, 4, 5] }
            ],
            result_logic: (score) => {
                if (score <= 10) return { title: "Baixo Risco", content: "Seu nível de esgotamento é baixo, mas mantenha o equilíbrio." };
                if (score <= 18) return { title: "Atenção Moderada", content: "Sinais de estresse. É hora de reavaliar sua rotina e buscar descanso." };
                return { title: "Risco Elevado de Burnout", content: "Alto nível de esgotamento. Procure ajuda profissional e faça uma pausa imediata." };
            }
        },
        // Adicione mais quizzes aqui, seguindo a estrutura
        // qi: { title: "Teste de QI Rápido", ... },
        // stress: { title: "Nível de Estresse", ... }
    };

    // --- CHAVES DE PAGAMENTO KO-FI ---
    // SEU LINK DO PRODUTO NO KO-FI (R$ 8,99):
    const CHECKOUT_URL = 'https://ko-fi.com/s/5124029c9a';
    // Chave secreta que o Ko-fi deve retornar
    const SECRET_KEY = 'PsicoQuizLiberado'; 
    // Preço para exibição no modal
    const PRICE_DISPLAY = "R$ 8,99"; 


    let activeQuiz = null;
    let quizState = {}; // Guarda as respostas [questionIndex]: score

    // --- FUNÇÕES DE NAVEGAÇÃO E ESTADO ---

    // 1. Renderiza os cartões de seleção de quiz
    function renderQuizCards() {
        const grid = document.getElementById('quiz-cards-grid');
        grid.innerHTML = '';
        Object.keys(QUIZ_DATA).forEach(key => {
            const quiz = QUIZ_DATA[key];
            const card = document.createElement('div');
            card.className = `quiz-card-select bg-cover-center ${quiz.image_id} p-6 flex items-end text-left shadow-lg`;
            card.setAttribute('data-quiz', key);
            card.innerHTML = `
                <div class="quiz-content text-white">
                    <h3 class="text-3xl font-bold mb-2 text-shadow">${quiz.title}</h3>
                    <p class="text-md font-semibold text-shadow">${quiz.description}</p>
                </div>
            `;
            card.onclick = () => startQuiz(key);
            grid.appendChild(card);
        });
    }

    // 2. Inicia o quiz selecionado
    function startQuiz(key) {
        activeQuiz = key;
        quizState = {};
        const quizData = QUIZ_DATA[activeQuiz];
        
        document.getElementById('quiz-selection').classList.add('hidden');
        document.getElementById('quiz-section').classList.remove('hidden');
        document.getElementById('active-quiz-title').textContent = quizData.title;
        document.getElementById('quiz-result').classList.add('hidden');
        document.getElementById('submit-quiz-btn').classList.add('hidden');

        renderQuestions(quizData.questions);
    }

    // 3. Renderiza as perguntas do quiz
    function renderQuestions(questions) {
        const container = document.getElementById('quiz-questions');
        container.innerHTML = '';
        questions.forEach((q, qIndex) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'p-5 border border-gray-200 rounded-lg shadow-sm bg-white';
            questionDiv.innerHTML = `
                <p class="text-lg font-semibold mb-4 text-gray-700">${(qIndex + 1)}. ${q.text}</p>
                <div class="flex flex-col sm:flex-row justify-between space-y-2 sm:space-y-0 sm:space-x-2">
                    ${q.scores.map((score, sIndex) => `
                        <button 
                            data-score="${score}" 
                            data-qindex="${qIndex}" 
                            onclick="selectOption(this, ${qIndex}, ${score})"
                            class="likert-option flex-1 py-2 px-3 text-center border border-gray-300 rounded-md text-sm font-medium hover:bg-blue-50 transition duration-150"
                        >
                            ${getLikertLabel(sIndex)}
                        </button>
                    `).join('')}
                </div>
            `;
            container.appendChild(questionDiv);
        });
    }

    // 4. Lógica para selecionar a opção e atualizar o estado
    function selectOption(button, qIndex, score) {
        // Remove a seleção de todos os botões desta pergunta
        const questionDiv = button.closest('.p-5');
        questionDiv.querySelectorAll('.likert-option').forEach(btn => {
            btn.classList.remove('selected-option');
        });

        // Adiciona a seleção ao botão clicado
        button.classList.add('selected-option');
        
        // Atualiza o estado
        quizState[qIndex] = score;

        // Verifica se todas as perguntas foram respondidas
        checkCompletion();
    }

    // 5. Verifica a conclusão e mostra o botão de submissão
    function checkCompletion() {
        const totalQuestions = QUIZ_DATA[activeQuiz].questions.length;
        const submittedQuestions = Object.keys(quizState).length;

        const submitBtn = document.getElementById('submit-quiz-btn');
        if (submittedQuestions === totalQuestions) {
            submitBtn.classList.remove('hidden');
            submitBtn.scrollIntoView({ behavior: 'smooth' });
        } else {
            submitBtn.classList.add('hidden');
        }
    }

    // 6. Envia o quiz e mostra o modal
    function submitQuiz() {
        if (!activeQuiz) return;

        // Calcular pontuação total
        const totalScore = Object.values(quizState).reduce((sum, score) => sum + score, 0);
        
        // Armazenar resultado no localStorage (para uso pós-pagamento)
        localStorage.setItem('quizResult', JSON.stringify({
            quiz: activeQuiz,
            score: totalScore,
            timestamp: new Date().toISOString()
        }));

        // Abrir o modal de compra
        openModal();
    }

    // --- LÓGICA DO MODAL / PAGAMENTO ---

    function openModal() {
        document.getElementById('purchase-modal').classList.remove('hidden');
        document.getElementById('modal-price').textContent = `Por ${PRICE_DISPLAY}`;
        document.getElementById('checkout-link').href = CHECKOUT_URL;
    }

    function closeModal() {
        document.getElementById('purchase-modal').classList.add('hidden');
    }

    // 7. Renderiza o resultado (só chamado após a validação da chave secreta)
    function renderResult(totalScore, quizKey) {
        const quizData = QUIZ_DATA[quizKey];
        const resultContainer = document.getElementById('quiz-result');
        const logicResult = quizData.result_logic(totalScore);

        resultContainer.innerHTML = `
            <h3 class="text-3xl font-extrabold text-pink-600 mb-4">${logicResult.title}</h3>
            <p class="text-2xl font-bold text-gray-800 mb-6">Sua Pontuação Total: <span class="text-green-600">${totalScore}</span></p>
            <div class="prose max-w-none">
                <p class="text-gray-700">${logicResult.content}</p>
                <p class="mt-4 font-semibold text-blue-600">Este é o Relatório Completo. O acesso foi liberado com sucesso.</p>
            </div>
            <button onclick="window.location.href='https://rhuangogu.github.io/psicoquiz/'" class="mt-6 px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">Voltar à Seleção</button>
        `;

        document.getElementById('quiz-questions').classList.add('hidden');
        document.getElementById('submit-quiz-btn').classList.add('hidden');
        resultContainer.classList.remove('hidden');
        resultContainer.scrollIntoView({ behavior: 'smooth' });
    }

    // --- LÓGICA DE VALIDAÇÃO DE ACESSO (O CORAÇÃO DO SISTEMA) ---

    function validateAccess() {
        const urlParams = new URLSearchParams(window.location.search);
        const receivedKey = urlParams.get('chave');

        if (receivedKey === SECRET_KEY) {
            // 1. Chave Secreta recebida, inicia tela de loading
            document.getElementById('loading-screen').classList.remove('hidden');

            // 2. Tenta recuperar o resultado do quiz
            const storedResult = localStorage.getItem('quizResult');

            if (storedResult) {
                const result = JSON.parse(storedResult);

                // 3. Simula um pequeno delay para a UX da tela de loading
                setTimeout(() => {
                    // Oculta loading
                    document.getElementById('loading-screen').classList.add('hidden');
                    
                    // Exibe a seção de quiz e oculta a seleção
                    document.getElementById('quiz-selection').classList.add('hidden');
                    document.getElementById('quiz-section').classList.remove('hidden');
                    
                    // Mostra o título correto
                    document.getElementById('active-quiz-title').textContent = QUIZ_DATA[result.quiz].title;
                    
                    // Renderiza o resultado final
                    renderResult(result.score, result.quiz);
                    
                    // Limpa a chave da URL (para não ser usada de novo)
                    history.replaceState(null, '', window.location.pathname);
                    
                    // Opcional: Limpa o resultado armazenado
                    localStorage.removeItem('quizResult'); 
                }, 1500); // 1.5 segundos de espera
                
                return true; // Acesso liberado
            } else {
                // Se a chave veio, mas não há resultado salvo (usuário limpou cache/navegou)
                document.getElementById('loading-screen').classList.add('hidden');
                alert("Acesso liberado, mas não encontramos o resultado do seu quiz. Por favor, refaça o teste.");
                history.replaceState(null, '', window.location.pathname);
            }
        }
        return false; // Acesso não liberado
    }

    // --- UTILIDADES ---
    function getLikertLabel(index) {
        const labels = ["Discordo Totalmente", "Discordo", "Neutro", "Concordo", "Concordo Totalmente"];
        return labels[index] || `Opção ${index + 1}`;
    }


    // --- INICIALIZAÇÃO ---
    document.addEventListener('DOMContentLoaded', () => {
        // Tenta validar o acesso (se a pessoa veio do Ko-fi)
        const accessGranted = validateAccess();

        if (!accessGranted) {
            // Se o acesso NÃO foi concedido, renderiza a seleção de quizzes normalmente
            renderQuizCards();
        }

        // Adiciona o listener para o botão de submissão
        document.getElementById('submit-quiz-btn').addEventListener('click', submitQuiz);
    });

</script>
</body>
</html>
